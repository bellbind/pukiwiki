PukiWiki SETTING
$Id: SETTING.txt,v 1.6 2006/09/27 14:33:07 henoheno Exp $


設定の調整とカスタマイズ
========================

概要
    PukiWikiの設定は、管理者がPHPスクリプトを編集する事によって行います。
    通常は以下に示す代表的なファイルの中に設定を行います。

    PukiWikiのパッケージに含まれているPHPスクリプトは(あれば、基本的に)EUC-
    JPで、また改行コードLFで記述されています。(UTF-8版の場合は全てUTF-8/LF
    で記述されています)
    スクリプトを直接編集する場合は、文字コードと改行コードを判別でき、それを
    維持できるテキストエディタを使用して下さい。

    主な設定は以下で行います。
        実行開始地点       : index.php
        全体設定           : pukiwiki.ini.php
        ユーザ定義         : rules.ini.php

    ユーザーエージェントのグループ(profile)ごとにも設定が用意されています。
        デスクトップPC     : default.ini.php
        携帯電話およびPDA  : keitai.ini.php

    メッセージの多くは言語ごとにまとめられています。
        英語(en)向け       : en.lng.php
        日本語(ja)向け     : ja.lng.php

    スキン(デザイン部分)独自の設定項目は skin/<スキン名称>.skin.php の先頭
    にあります。

    プラグイン独自の設定項目は plugin/<プラグイン名称>.inc.php の先頭にあり
    ます。

    設定を「有効にする」とは多くの場合、設定値を数字の 0 でない値(例えば1)
    にする事です。一部の設定は名前に DISABLE ないし $noXXX とありますが、そ
    れらは値を 0 でないものにすることによって、その設定値に対応する機能が無
    効になります。(無効にする、という役割が有効になります)


PHP言語について

    PHP言語について詳しくはPHPマニュアルを参照して下さい。
    http://jp.php.net/manual/ja/

    PukiWikiの設定項目は、基本的に '定数' と '変数' によって表現されていま
    す。

正規表現について

    PHP言語は、Perl 5互換の正規表現をサポートしています。
    http://jp.php.net/manual/ja/reference.pcre.pattern.syntax.php

    PukiWikiの設定項目のいくつかは、"あるパターンに一致する(任意の)文字列"
    を表現するために正規表現を利用しています。

実行開始地点 (index.php)
    このファイルにWebブラウザ経由でアクセスする事により、PukiWiki が実行さ
    れます。

    ファイル名が 'index.php' である必要はありませんが、多くのWebサーバーは
    ファイル名を省略された時に index.php を参照するように設定されています。
    今回用意するWikiが、そのディレクトリにとって主要なコンテンツであるなら
    ば、このままで不都合はないでしょう。

    いくつかの設定項目は、このファイル中で事前に指定する事ができます。

    例えばメンテナンスの間だけ PKWK_READONLY を有効にするにより、編集を禁止
    する事ができます。

    また、このファイルをコピーして異なる名称で複数個用意し、それぞれ設定の
    内容を変えておくことで、設定の使い分けが可能になります。

    例えば、全てのページに編集認証をかけた上、index.php では PKWK_READONLY
    を有効に、secret.php では PKWK_READONLY を 無効に する事によって、限ら
    れたメンバーだけ編集できる環境を構築する事ができます。

    このファイルの中に加えられる代表的な設定項目は以下の通りです。

    error_reporting() 関数
        これはPHP言語で用意されている、出力するエラーの種類を制御する関数で
        す。特にPHP言語レベルの障害切り分けを行いたい場合、
            error_reporting(E_ALL);
        と記述する事により、通常は表示されないPHPのエラーを表示させる事がで
        きます。

    設定項目(定数)の事前定義
        以下に挙げる設定項目(定数)は、このファイルで事前に定義する事ができ
        ます。
            PKWK_READONLY
            PKWK_SAFE_MODE
            PKWK_OPTIMISE
            PKWK_DISABLE_INLINE_IMAGE_FROM_URI
            PKWK_QUERY_STRING_MAX
            TDIARY_THEME
        PHP言語では定数の値を後から変更する事ができないため、管理者はここで
        設定した内容を確実に強制する事ができます。
        個々の項目の詳細は pukiwiki.ini.php の説明を参照して下さい。

    ディレクトリ設定
        この値を調整する事により、異なる場所にあるPukiWiki本体を呼び出す事
        ができます。例えば、PukiWiki本体をWebブラウザからアクセスできない場
        所に設置し、Webブラウザからアクセスできる場所には実行開始地点だけを
        用意する事ができます。
        (Webブラウザから参照される画像ファイル、css、JavaScriptなどについて
        はWebブラウザからアクセスできる場所に置く必要があります)

        LIB_DIR
            PukiWikiが利用する関数がまとめられているファイルが設置されてい
            る場所をサーバー内の絶対パス、または相対パスでで指定します。

        DATA_HOME
            一本のPukiWikiに関する独自の部分(設定項目、採用しているプラグイ
            ン等)を格納する場所をサーバー内の絶対パス、または相対パスでで指
            定します。

        複数のPukiWikiが同じLIB_DIRを共有し、異なるDATA_HOMEにデータを保存
        することも可能です。(しかしPukiWikiを複数個用意する方が一般的に簡単
        です)


全体設定 (pukiwiki.ini.php)
    このファイルに主だった設定を記述します。項目の多くはグローバル変数、そ
    れ以外は定数です。多くの設定は、デフォルトの値が設定済みです。管理者は
    環境に応じて設定を調整して下さい。

    このファイルの中に存在する代表的な設定項目は以下の通りです。

    定数 PKWK_OPTIMISE
        本来不要な(過剰な、冗長な、アクセスが集中する時に動作させたくない)
        チェックや挙動を積極的に停止します。PukiWikiがその環境で問題なく動
        作する事を、管理者が確認した後に有効にする事ができます。

    定数 PKWK_READONLY
        PukiWikiを編集不可能な状態にします。メンテナンスをしている間ユーザ
        ーの編集を止めたい時、緊急ロックを行いたい時、ミラーサイトを構築す
        る時、閲覧専用の環境としてPukiWikiを使用したい時、そのPukiWikiの運
        営を終了する時に有効にする事ができます。(詳細:BugTrack/744)

        PKWK_READONLY が有効であると、編集用のユーザーインターフェースは表
        示されなくなり、編集に関する内部の機構(関数)は動作しなくなります。
        入力フォームを出力するプラグインは、テキスト入力フィールドやボタン
        などを表示しなくなります。(commentプラグインのコメント欄など)管理者
        パスワードに対する認証行為は(仮にあったとしても)必ず判定に失敗する
        ようになります。

        アクセスカウンターなどの機構は、この設定の影響を受けません。
        また、この設定を尊重しない(第三者が作成した)プラグインなどには効果
        がありません。

    定数 PKWK_SAFE_MODE
        PukiWikiをインターネット上に公開する場合、この設定を有効にして下さ
        い。もはや利用されていない機能、その他安全とは思われない機能が無効
        になります。(詳細:BugTrack/787)

    定数 PKWK_DISABLE_INLINE_IMAGE_FROM_URI
        '画像ファイルへのURL' であるかのように見えるURLについて、そのURLを
        (画像であるかのように)imgタグのソースとして用いる挙動を禁止します。

        この機能は画像をインラインイメージとしてページに埋め込むための簡便
        な方法としてに用意されているものですが、その一方で、広告を目的とし
        た画像の掲示を行うために悪用されたり、閲覧者の情報を自動的に送信す
        るCGIへのURL(ただしURLは画像へのURLのように見える)を設置される可能
        性が生じます。

    定数 PKWK_QUERY_STRING_MAX
        PukiWiki にアクセスできるクエリ文字列(PukiWikiにアクセスしたときのU
        RLのうち、'?' 以降の部分)の長さの限界値を定義することができます。こ
        の値を超える長さのアクセスがあった場合、それ以降の処理を行いません。

        この設定は明らかに異常なアクセスを、なるべく早い時点で区別するため
        のフィルタとして働きます。その一方で、この設定が十分に大きくない場
        合、(attachプラグインのように)特別にURLが長くなる可能性のあるプラグ
        インの動作が遮断される可能性があります。

    定数 PKWKEXP_DISABLE_MULTILINE_PLUGIN_HACK (実験実装)
        <<これは実験的な実装であり、より適切な実装へ(互換性のない形で)変更さ
        れるか、不適切な実装として存在しなくなる可能性があります>>

        この設定を 無効 にし、これに対応する専用の記法でテキストを書くこと
        により、複数行のデータを受け付けるブロックプラグインが動作するよう
        になります。(詳細:BugTrack2/84)

        (PukiWiki 1.4.7) 現在の実装には #memo プラグインのような一部のプラ
        グインと干渉する、という致命的な欠陥があります。

    定数 LANG
        PukiWikiがサーバー内に保存する言語を大雑把に指定します。ここではen,
        jaといったISO 639の言語コードで表現されていますが、この値は、この後
        に続く設定を大まかに切り替えるためのスイッチとしての役割しかありま
        せん。

    定数 UI_LANG
        PukiWikiがユーザーに提示するユーザーインターフェース部分の言語を大
        雑把に指定します。ルールは LANG と同じです。この設定は、例えば "テ
        キストデータとしては様々な言語を入力したいが、ユーザーインターフェ
        ースは英語に揃えたい" といった要望を実現するためのものです。

     定数: ディレクトリ設定
     DATA_DIR, DIFF_DIR, BACKUP_DIR, CACHE_DIR, UPLOAD_DIR, COUNTER_DIR,
     TRACKBACK_DIR, PLUGIN_DIR
         ここで指定されているディレクトリは、PukiWiki(PHPスクリプト)が必要
         に応じてアクセスする場所になります。

         DATA_DIR, DIFF_DIR, BACKUP_DIR, CACHE_DIR, COUNTER_DIR には、PukiW
         ikiが書き込み権限を持っている必要があります。

         UPLOAD_DIR には、もしattachプラグインを使用しないのであれば書き込
         み権限は必要ありません。同様に、TRACKBACK_DIR は、もし trackback
         の機構を利用しないのであれば書き込み権限は必要ありません。

         PLUGIN_DIR には、PukiWikiは書き込み権限を必要としません。
         (セキュリティ上、書き込み権限を与えてはいけません)

    定数: SKIN_DIR
        この定数は現在二つの意味を持っています。

        1. PukiWikiが、PHPスクリプトとして 'スキン' ファイルを探すべき場所
        2. Webブラウザが、cssなどを探すべき場所

        'スキン' ファイルはPukiWikiが(PHPのレベルで)アクセスするため、Webサ
        ーバーから見える場所に配置する必要はありません。

        cssファイルなどは、ユーザーがWebブラウザからアクセスするため、Webサ
        ーバーから見える場所になければいけません。

        PukiWiki本体をWebサーバーから見えない場所に設置した場合、SKIN_DIRで
        定義しているディレクトリをWebブラウザから見える場所に用意し、そこに
        cssファイルを設置する必要があります。

    定数: IMAGE_DIR
        PukiWikiから参照される、アイコンやシンボルマークなどの画像が配置さ
        れたディレクトリの場所を指定します。このディレクトリとその内容は、
        Webブラウザからアクセスできる場所に置かなければいけません。

    定数: ZONE, ZONETIME
        PukiWikiを設置しているサーバーが属するタイムゾーン(時差が同じである
        としている地域の大まかな呼び名)、およびGMT(ないしUTC)との時差を設定
        します。

    変数 $page_title
        ここで設定した文字列は、PukiWikiが出力するXHTMLのtitleタグなどに用
        いられます。結果的に、そのPukiWikiが何であるのか(アイデンティティ)
        をユーザーに伝達します。

        必要があれば、特定のPukiWiki を指すことができる固有の名前を設定する
        ことができます。InterWikiの仕組みを活用したい場合、InterWikiのキー
        ワードとしても使うことができ、短くてユニークなものが好ましいでしょ
        う。


設定の修正
    PukiWikiの管理者パスワードは、pukiwiki.ini.php にある変数 $adminpass
    です。簡単に試すだけであるならば、以下のような内容で充分でしょう。
     ('YourPassWord' の部分を、あなただけのキーワードで置き換えて下さい)

        $adminpass = '{x-php-md5}' . md5('YourPassWord');

スキンの変更または調整
    スキン(外見の骨組み)に関する設定項目は skin/スキン名.skin.php の先頭にあ
    ります。

    付属のtDiaryスキンに切り替える事によって、tDiary用のテーマを使用する事が
    できます。詳しくは BugTrack/769 を参照して下さい。
 
    その他、ユーザーが作成した独自のスキンについては
    [[official:自作スキン]] を参照して下さい。
    http://pukiwiki.sourceforge.jp/?%E8%87%AA%E4%BD%9C%E3%82%B9%E3%82%AD%E3%83%B3


デザインの調整
    必要に応じて、さらに設定やデザインを調整して下さい。

    ※デフォルトのスキンの場合、CSSは skin/スキン名.css.php が出力します。こ
      れは目的に応じたCSSを出力することのできる、単独のPHPスクリプトです。
      これを静的なファイルにしたい場合は、Webブラウザで出力結果を取り出して
      下さい。どのようなCSSが求められているかはスキンに記述されています。
